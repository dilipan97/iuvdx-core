{"ast":null,"code":"import _classCallCheck from\"/home/dilip/Desktop/iuvdx-core/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/dilip/Desktop/iuvdx-core/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/dilip/Desktop/iuvdx-core/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/dilip/Desktop/iuvdx-core/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/dilip/Desktop/iuvdx-core/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import IconButton from'@material-ui/core/IconButton';import Fab from'@material-ui/core/Fab';import HighlightOff from'@material-ui/icons/HighlightOff';import Send from'@material-ui/icons/Send';import'./ChatComponent.css';import{Tooltip}from'@material-ui/core';var ChatComponent=/*#__PURE__*/function(_Component){_inherits(ChatComponent,_Component);var _super=_createSuper(ChatComponent);function ChatComponent(props){var _this;_classCallCheck(this,ChatComponent);_this=_super.call(this,props);_this.state={messageList:[],message:''};_this.chatScroll=React.createRef();_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_this));_this.handlePressKey=_this.handlePressKey.bind(_assertThisInitialized(_this));_this.close=_this.close.bind(_assertThisInitialized(_this));_this.sendMessage=_this.sendMessage.bind(_assertThisInitialized(_this));return _this;}_createClass(ChatComponent,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.props.user.getStreamManager().stream.session.on('signal:chat',function(event){var data=JSON.parse(event.data);var messageList=_this2.state.messageList;messageList.push({connectionId:event.from.connectionId,nickname:data.nickname,message:data.message});var document=window.document;setTimeout(function(){var userImg=document.getElementById('userImg-'+(_this2.state.messageList.length-1));var video=document.getElementById('video-'+data.streamId);var avatar=userImg.getContext('2d');avatar.drawImage(video,200,120,285,285,0,0,60,60);_this2.props.messageReceived();},50);_this2.setState({messageList:messageList});_this2.scrollToBottom();});}},{key:\"handleChange\",value:function handleChange(event){this.setState({message:event.target.value});}},{key:\"handlePressKey\",value:function handlePressKey(event){if(event.key==='Enter'){this.sendMessage();}}},{key:\"sendMessage\",value:function sendMessage(){console.log(this.state.message);if(this.props.user&&this.state.message){var message=this.state.message.replace(/ +(?= )/g,'');if(message!==''&&message!==' '){var data={message:message,nickname:this.props.user.getNickname(),streamId:this.props.user.getStreamManager().stream.streamId};this.props.user.getStreamManager().stream.session.signal({data:JSON.stringify(data),type:'chat'});}}this.setState({message:''});}},{key:\"scrollToBottom\",value:function scrollToBottom(){var _this3=this;setTimeout(function(){try{_this3.chatScroll.current.scrollTop=_this3.chatScroll.current.scrollHeight;}catch(err){}},20);}},{key:\"close\",value:function close(){this.props.close(undefined);}},{key:\"render\",value:function render(){var _this4=this;var styleChat={display:this.props.chatDisplay};return/*#__PURE__*/React.createElement(\"div\",{id:\"chatContainer\"},/*#__PURE__*/React.createElement(\"div\",{id:\"chatComponent\",style:styleChat},/*#__PURE__*/React.createElement(\"div\",{id:\"chatToolbar\"},/*#__PURE__*/React.createElement(\"span\",null,this.props.user.getStreamManager().stream.session.sessionId,\" - CHAT\"),/*#__PURE__*/React.createElement(IconButton,{id:\"closeButton\",onClick:this.close},/*#__PURE__*/React.createElement(HighlightOff,{color:\"secondary\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"message-wrap\",ref:this.chatScroll},this.state.messageList.map(function(data,i){return/*#__PURE__*/React.createElement(\"div\",{key:i,id:\"remoteUsers\",className:'message'+(data.connectionId!==_this4.props.user.getConnectionId()?' left':' right')},/*#__PURE__*/React.createElement(\"canvas\",{id:'userImg-'+i,width:\"60\",height:\"60\",className:\"user-img\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"msg-detail\"},/*#__PURE__*/React.createElement(\"div\",{className:\"msg-info\"},/*#__PURE__*/React.createElement(\"p\",null,\" \",data.nickname)),/*#__PURE__*/React.createElement(\"div\",{className:\"msg-content\"},/*#__PURE__*/React.createElement(\"span\",{className:\"triangle\"}),/*#__PURE__*/React.createElement(\"p\",{className:\"text\"},data.message))));})),/*#__PURE__*/React.createElement(\"div\",{id:\"messageInput\"},/*#__PURE__*/React.createElement(\"input\",{placeholder:\"Send a messge\",id:\"chatInput\",value:this.state.message,onChange:this.handleChange,onKeyPress:this.handlePressKey}),/*#__PURE__*/React.createElement(Tooltip,{title:\"Send message\"},/*#__PURE__*/React.createElement(Fab,{size:\"small\",id:\"sendButton\",onClick:this.sendMessage},/*#__PURE__*/React.createElement(Send,null))))));}}]);return ChatComponent;}(Component);export{ChatComponent as default};","map":{"version":3,"sources":["/home/dilip/Desktop/iuvdx-core/client/src/components/chat/ChatComponent.js"],"names":["React","Component","IconButton","Fab","HighlightOff","Send","Tooltip","ChatComponent","props","state","messageList","message","chatScroll","createRef","handleChange","bind","handlePressKey","close","sendMessage","user","getStreamManager","stream","session","on","event","data","JSON","parse","push","connectionId","from","nickname","document","window","setTimeout","userImg","getElementById","length","video","streamId","avatar","getContext","drawImage","messageReceived","setState","scrollToBottom","target","value","key","console","log","replace","getNickname","signal","stringify","type","current","scrollTop","scrollHeight","err","undefined","styleChat","display","chatDisplay","sessionId","map","i","getConnectionId"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport IconButton from '@material-ui/core/IconButton';\nimport Fab from '@material-ui/core/Fab';\nimport HighlightOff from '@material-ui/icons/HighlightOff';\nimport Send from '@material-ui/icons/Send';\n\nimport './ChatComponent.css';\nimport { Tooltip } from '@material-ui/core';\n\nexport default class ChatComponent extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            messageList: [],\n            message: '',\n        };\n        this.chatScroll = React.createRef();\n\n        this.handleChange = this.handleChange.bind(this);\n        this.handlePressKey = this.handlePressKey.bind(this);\n        this.close = this.close.bind(this);\n        this.sendMessage = this.sendMessage.bind(this);\n    }\n\n\n    componentDidMount() {\n        this.props.user.getStreamManager().stream.session.on('signal:chat', (event) => {\n            const data = JSON.parse(event.data);\n            let messageList = this.state.messageList;\n            messageList.push({ connectionId: event.from.connectionId, nickname: data.nickname, message: data.message });\n            const document = window.document;\n            setTimeout(() => {\n                const userImg = document.getElementById('userImg-' + (this.state.messageList.length - 1));\n                const video = document.getElementById('video-' + data.streamId);\n                const avatar = userImg.getContext('2d');\n                avatar.drawImage(video, 200, 120, 285, 285, 0, 0, 60, 60);\n                this.props.messageReceived();\n            }, 50);\n            this.setState({ messageList: messageList });\n            this.scrollToBottom();\n        });\n    }\n\n    handleChange(event) {\n        this.setState({ message: event.target.value });\n    }\n\n    handlePressKey(event) {\n        if (event.key === 'Enter') {\n            this.sendMessage();\n        }\n    }\n\n    sendMessage() {\n        console.log(this.state.message);\n        if (this.props.user && this.state.message) {\n            let message = this.state.message.replace(/ +(?= )/g, '');\n            if (message !== '' && message !== ' ') {\n                const data = { message: message, nickname: this.props.user.getNickname(), streamId: this.props.user.getStreamManager().stream.streamId };\n                this.props.user.getStreamManager().stream.session.signal({\n                    data: JSON.stringify(data),\n                    type: 'chat',\n                });\n            }\n        }\n        this.setState({ message: '' });\n    }\n\n    scrollToBottom() {\n        setTimeout(() => {\n            try {\n                this.chatScroll.current.scrollTop = this.chatScroll.current.scrollHeight;\n            } catch (err) {}\n        }, 20);\n    }\n\n    close() {\n        this.props.close(undefined);\n    }\n\n    render() {\n        const styleChat = { display: this.props.chatDisplay };\n        return (\n            <div id=\"chatContainer\">\n                <div id=\"chatComponent\" style={styleChat}>\n                    <div id=\"chatToolbar\">\n                        <span>{this.props.user.getStreamManager().stream.session.sessionId} - CHAT</span>\n                        <IconButton id=\"closeButton\" onClick={this.close}>\n                            <HighlightOff color=\"secondary\" />\n                        </IconButton>\n                    </div>\n                    <div className=\"message-wrap\" ref={this.chatScroll}>\n                        {this.state.messageList.map((data, i) => (\n                            <div\n                                key={i}\n                                id=\"remoteUsers\"\n                                className={\n                                    'message' + (data.connectionId !== this.props.user.getConnectionId() ? ' left' : ' right')\n                                }\n                            >\n                                <canvas id={'userImg-' + i} width=\"60\" height=\"60\" className=\"user-img\" />\n                                <div className=\"msg-detail\">\n                                    <div className=\"msg-info\">\n                                        <p> {data.nickname}</p>\n                                    </div>\n                                    <div className=\"msg-content\">\n                                        <span className=\"triangle\" />\n                                        <p className=\"text\">{data.message}</p>\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n\n                    <div id=\"messageInput\">\n                        <input\n                            placeholder=\"Send a messge\"\n                            id=\"chatInput\"\n                            value={this.state.message}\n                            onChange={this.handleChange}\n                            onKeyPress={this.handlePressKey}\n                        />\n                        <Tooltip title=\"Send message\">\n                            <Fab size=\"small\" id=\"sendButton\" onClick={this.sendMessage}>\n                                <Send />\n                            </Fab>\n                        </Tooltip>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n"]},"metadata":{},"sourceType":"module"}